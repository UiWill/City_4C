import{d as Z,r as u,m as K,y as O,E as P,o as Q,c as l,b as t,p as c,j as w,k as L,e as B,F as S,A as x,h as z,t as r,C as m,O as p,n as H,D as W,i as X,q as T,x as Y,l as i,_ as tt}from"./index-CSfAbG_0.js";import{f as _,p as st}from"./pt-BR-BZBxiJ23.js";const ot={class:"occurrences-view"},et={class:"filters-section"},at={class:"filters-row"},lt={class:"filter-group"},it={class:"filter-group"},nt=["value"],rt={class:"filter-group"},dt={class:"filter-actions"},ut=["disabled"],ct={key:0,class:"animate-spin",viewBox:"0 0 24 24",fill:"currentColor"},pt={key:1,viewBox:"0 0 24 24",fill:"currentColor"},vt={class:"results-summary"},gt={key:0},yt={key:0,class:"loading-state"},ft={key:1,class:"empty-state"},mt={key:0},_t={key:1},bt={key:2,class:"occurrences-table-container"},Ct={class:"occurrences-table"},ht=["onClick"],kt={class:"occurrence-title-cell"},wt={class:"title-content"},Lt={key:0,class:"description-preview"},St={class:"priority-indicator"},xt={class:"location-cell"},Mt={class:"location-info"},Et={key:0},Vt={key:1},Rt={class:"actions-cell"},At=["onClick"],Dt=["onClick"],Ot=["onClick"],Pt={key:3,class:"pagination"},Bt=["disabled"],zt={class:"pagination-info"},Ht=["disabled"],M=20,Tt=Z({__name:"OccurrencesView",setup(Nt){const N=Y(),y=u([]),E=u([]),b=u(!1),v=u(!1),d=u(1),V=u(0),g=u(0),n=K({status:"",tag_id:"",priority:""}),C=O(()=>Math.ceil(g.value/M)),h=O(()=>n.status||n.tag_id||n.priority),f=async()=>{b.value=!0;try{const a={limit:M,offset:(d.value-1)*M};n.status&&(a.status=n.status),n.tag_id&&(a.tag_id=Number(n.tag_id));const s=await m.getOccurrences(a);let o=s;n.priority&&(o=s.filter(e=>e.priority===Number(n.priority))),y.value=o,g.value=o.length,h.value||(V.value=o.length)}catch(a){console.error("Error loading occurrences:",a)}finally{b.value=!1}},j=async()=>{try{E.value=await m.getTags()}catch(a){console.error("Error loading tags:",a)}},R=a=>{N.push(`/occurrences/${a}`)},A=async(a,s)=>{try{await m.updateOccurrenceStatus(a,s),await f()}catch(o){console.error("Error updating status:",o)}},F=()=>{n.status="",n.tag_id="",n.priority="",d.value=1},$=async()=>{v.value=!0;try{const a=await m.getOccurrences({}),s=I(a);U(s,`ocorrencias_${_(new Date,"yyyy-MM-dd_HH-mm")}.csv`)}catch(a){console.error("Error exporting CSV:",a)}finally{v.value=!1}},I=a=>{const s=["ID","Título","Descrição","Status","Prioridade","Categoria","Latitude","Longitude","Endereço","Tipo Relator","Relator","Data Criação","Data Resolução"],o=a.map(e=>[e.id,e.title||"",e.description||"",D(e.status),e.priority.toString(),e.tags?.name||"",e.latitude.toString(),e.longitude.toString(),e.address||"",e.reporter_type==="agent"?"Agente":"Cidadão",e.profiles?.full_name||"Anônimo",_(new Date(e.created_at),"dd/MM/yyyy HH:mm"),e.resolved_at?_(new Date(e.resolved_at),"dd/MM/yyyy HH:mm"):""]);return[s,...o].map(e=>e.map(k=>`"${k}"`).join(",")).join(`
`)},U=(a,s)=>{const o=new Blob([a],{type:"text/csv;charset=utf-8;"}),e=document.createElement("a"),k=URL.createObjectURL(o);e.setAttribute("href",k),e.setAttribute("download",s),e.style.visibility="hidden",document.body.appendChild(e),e.click(),document.body.removeChild(e)},D=a=>({[p.PENDING]:"Pendente",[p.IN_PROGRESS]:"Em Andamento",[p.RESOLVED]:"Resolvido",[p.REJECTED]:"Rejeitado"})[a]||a,q=()=>{d.value>1&&d.value--},G=()=>{d.value<C.value&&d.value++},J=a=>_(new Date(a),"dd/MM/yyyy HH:mm",{locale:st});return P(n,()=>{d.value=1,f()},{deep:!0}),P(d,()=>{f()}),Q(async()=>{await Promise.all([j(),f()])}),(a,s)=>(i(),l("div",ot,[t("div",et,[t("div",at,[t("div",lt,[s[5]||(s[5]=t("label",{for:"status-filter",class:"filter-label"},"Status",-1)),w(t("select",{id:"status-filter","onUpdate:modelValue":s[0]||(s[0]=o=>n.status=o),class:"form-select"},s[4]||(s[4]=[B('<option value="" data-v-c185166d>Todos</option><option value="pending" data-v-c185166d>Pendente</option><option value="in_progress" data-v-c185166d>Em Andamento</option><option value="resolved" data-v-c185166d>Resolvido</option><option value="rejected" data-v-c185166d>Rejeitado</option>',5)]),512),[[L,n.status]])]),t("div",it,[s[7]||(s[7]=t("label",{for:"tag-filter",class:"filter-label"},"Categoria",-1)),w(t("select",{id:"tag-filter","onUpdate:modelValue":s[1]||(s[1]=o=>n.tag_id=o),class:"form-select"},[s[6]||(s[6]=t("option",{value:""},"Todas",-1)),(i(!0),l(S,null,x(E.value,o=>(i(),l("option",{key:o.id,value:o.id},r(o.name),9,nt))),128))],512),[[L,n.tag_id]])]),t("div",rt,[s[9]||(s[9]=t("label",{for:"priority-filter",class:"filter-label"},"Prioridade",-1)),w(t("select",{id:"priority-filter","onUpdate:modelValue":s[2]||(s[2]=o=>n.priority=o),class:"form-select"},s[8]||(s[8]=[B('<option value="" data-v-c185166d>Todas</option><option value="5" data-v-c185166d>Crítica</option><option value="4" data-v-c185166d>Alta</option><option value="3" data-v-c185166d>Média</option><option value="2" data-v-c185166d>Baixa</option><option value="1" data-v-c185166d>Mínima</option>',6)]),512),[[L,n.priority]])]),t("div",dt,[t("button",{onClick:F,class:"btn btn-secondary"}," Limpar Filtros "),t("button",{onClick:$,class:"btn btn-primary",disabled:v.value},[v.value?(i(),l("svg",ct,s[10]||(s[10]=[t("path",{d:"M12 4V2A10 10 0 0 0 2 12h2a8 8 0 0 1 8-8z"},null,-1)]))):(i(),l("svg",pt,s[11]||(s[11]=[t("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"},null,-1)]))),z(" "+r(v.value?"Exportando...":"Exportar CSV"),1)],8,ut)])])]),t("div",vt,[t("p",null,[t("strong",null,r(g.value),1),z(" ocorrência"+r(g.value!==1?"s":"")+" encontrada"+r(g.value!==1?"s":"")+" ",1),h.value?(i(),l("span",gt," (filtrado de "+r(V.value)+" total)",1)):c("",!0)])]),b.value?(i(),l("div",yt,s[12]||(s[12]=[t("div",{class:"spinner"},null,-1),t("p",null,"Carregando ocorrências...",-1)]))):y.value.length===0?(i(),l("div",ft,[s[13]||(s[13]=t("svg",{class:"empty-icon",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})],-1)),s[14]||(s[14]=t("h3",null,"Nenhuma ocorrência encontrada",-1)),h.value?(i(),l("p",mt," Tente ajustar os filtros para ver mais resultados. ")):(i(),l("p",_t," As ocorrências aparecerão aqui quando forem reportadas através do aplicativo. "))])):(i(),l("div",bt,[t("table",Ct,[s[20]||(s[20]=t("thead",null,[t("tr",null,[t("th",null,"Status"),t("th",null,"Título"),t("th",null,"Categoria"),t("th",null,"Prioridade"),t("th",null,"Localização"),t("th",null,"Data"),t("th",null,"Ações")])],-1)),t("tbody",null,[(i(!0),l(S,null,x(y.value,o=>(i(),l("tr",{key:o.id,class:"occurrence-row",onClick:e=>R(o.id)},[t("td",null,[t("span",{class:H(["status-badge",`status-badge--${o.status.replace("_","-")}`])},r(D(o.status)),3)]),t("td",kt,[t("div",wt,[t("h4",null,r(o.title||"Ocorrência sem título"),1),o.description?(i(),l("p",Lt,r(o.description.substring(0,80))+r(o.description.length>80?"...":""),1)):c("",!0)])]),t("td",null,[o.tags?(i(),l("span",{key:0,class:"category-tag",style:W({backgroundColor:o.tags.color+"20",color:o.tags.color})},r(o.tags.name),5)):c("",!0)]),t("td",null,[t("div",St,[(i(),l(S,null,x(5,e=>t("svg",{key:e,class:H(["priority-star",{"priority-star--active":e<=o.priority}]),viewBox:"0 0 24 24",fill:"currentColor"},s[15]||(s[15]=[t("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"},null,-1)]),2)),64))])]),t("td",xt,[t("div",Mt,[s[16]||(s[16]=t("svg",{class:"location-icon",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})],-1)),o.address?(i(),l("span",Et,r(o.address.length>40?o.address.substring(0,40)+"...":o.address),1)):(i(),l("span",Vt,r(o.latitude.toFixed(4))+", "+r(o.longitude.toFixed(4)),1))])]),t("td",null,r(J(o.created_at)),1),t("td",Rt,[t("div",{class:"quick-actions",onClick:s[3]||(s[3]=X(()=>{},["stop"]))},[o.status==="pending"?(i(),l("button",{key:0,class:"action-btn action-btn--success",onClick:e=>A(o.id,T(p).IN_PROGRESS),title:"Aceitar"},s[17]||(s[17]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"})],-1)]),8,At)):c("",!0),o.status==="in_progress"?(i(),l("button",{key:1,class:"action-btn action-btn--success",onClick:e=>A(o.id,T(p).RESOLVED),title:"Resolver"},s[18]||(s[18]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"})],-1)]),8,Dt)):c("",!0),t("button",{class:"action-btn action-btn--primary",onClick:e=>R(o.id),title:"Ver detalhes"},s[19]||(s[19]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})],-1)]),8,Ot)])])],8,ht))),128))])])])),y.value.length>0?(i(),l("div",Pt,[t("button",{disabled:d.value===1,onClick:q,class:"btn btn-secondary"}," Anterior ",8,Bt),t("span",zt," Página "+r(d.value)+" de "+r(C.value),1),t("button",{disabled:d.value===C.value,onClick:G,class:"btn btn-secondary"}," Próxima ",8,Ht)])):c("",!0)]))}}),$t=tt(Tt,[["__scopeId","data-v-c185166d"]]);export{$t as default};
