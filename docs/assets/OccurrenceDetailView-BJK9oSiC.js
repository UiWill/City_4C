import{d as X,E as ee,a as r,y as se,c as i,f as u,b as e,t as o,j as E,C as te,g as h,s as O,e as ae,w as oe,v as le,F as B,z as H,n as P,B as v,p as d,_ as ne}from"./index-CVPnme8S.js";import{f as ie,p as de}from"./pt-BR-BZBxiJ23.js";const re={class:"occurrence-detail"},ue={key:0,class:"loading-state"},ce={key:1,class:"error-state"},ve={key:2,class:"occurrence-content"},pe={class:"occurrence-header"},me={class:"header-main"},_e={class:"header-info"},ge={class:"header-meta"},fe={class:"occurrence-id"},ye={class:"occurrence-date"},be={class:"header-actions"},he={class:"status-controls"},Ce={class:"priority-controls"},we={class:"main-content"},Se={class:"left-column"},Ve={class:"video-section"},ke={class:"video-container"},Ae=["src"],Ee={key:0,class:"video-error"},Oe={class:"video-info"},xe={class:"video-meta"},De={class:"video-duration"},Me={class:"video-filename"},ze={key:0,class:"description-section"},Le={class:"description-content"},Re={class:"updates-section"},Ue={class:"add-comment"},$e=["disabled"],Be={key:0,class:"updates-list"},He={class:"update-header"},Pe={class:"update-author"},Fe={class:"author-avatar"},Ie={class:"author-info"},Ne={class:"author-name"},je={class:"update-date"},Te={key:0,class:"status-change"},qe={class:"update-content"},Ze={key:1,class:"no-updates"},Ge={class:"right-column"},Ye={class:"location-section"},Je={class:"location-content"},Ke={class:"map-placeholder"},Qe={class:"map-content"},We={class:"location-details"},Xe={class:"detail-item"},es={class:"value coordinates"},ss={key:0,class:"detail-item"},ts={class:"value"},as={key:1,class:"detail-item"},os={class:"value"},ls={class:"reporter-section"},ns={class:"reporter-content"},is={class:"reporter-info"},ds={class:"reporter-details"},rs={class:"detail-item"},us={class:"value"},cs={class:"detail-item"},vs={class:"value"},ps={key:0,class:"detail-item"},ms={class:"value"},_s={class:"assignment-section"},gs={class:"assignment-content"},fs=["value"],ys={key:0,class:"assigned-info"},bs={class:"agent-info"},hs={class:"agent-avatar"},Cs={class:"agent-details"},ws={class:"agent-name"},Ss={class:"agent-role"},Vs={key:0,class:"service-order-section"},ks={class:"service-order-content"},As={class:"os-header"},Es={class:"protocol-number"},Os={class:"value protocol"},xs={class:"os-details"},Ds={class:"detail-item"},Ms={class:"value"},zs={key:0,class:"detail-item"},Ls={class:"value"},Rs={key:1,class:"detail-item"},Us={key:2,class:"detail-item"},$s={class:"value"},Bs={class:"detail-item"},Hs={class:"value"},Ps={key:3,class:"detail-item"},Fs={class:"value"},Is={class:"os-actions"},Ns=["disabled"],js={class:"metadata-section"},Ts={class:"metadata-content"},qs={class:"detail-item"},Zs={class:"value"},Gs={class:"detail-item"},Ys={class:"value"},Js={key:0,class:"detail-item"},Ks={class:"value"},Qs={key:1,class:"detail-item"},Ws={class:"value"},Xs=X({__name:"OccurrenceDetailView",setup(et){const p=ee().params.id,a=r(null),x=r([]),L=r([]),l=r(null),D=r(!1),C=r(""),w=r(!1),_=r(""),R=r(""),S=r(!1),f=r("pending"),V=r(1),k=r(""),y=r("created"),b=r(),m=r(!1),A=async()=>{D.value=!0,C.value="";try{const t=await v.getOccurrenceById(p);if(a.value=t,f.value=t.status,V.value=t.priority,k.value=t.assigned_to||"",t.video_filename||t.video_url)try{let s=t.video_filename;if(!s&&t.video_url){const $=t.video_url.split("/");s=$[$.length-1]}const g=await v.findVideoFile(s)||s;console.log("Attempting to load video:",g);const W=await v.getVideoSignedUrl(g);a.value&&(a.value.video_url=W,m.value=!1)}catch{console.log("Video loading failed completely, using demo video"),m.value=!0,a.value&&(a.value.video_url="https://sample-videos.com/zip/10/mp4/720/SampleVideo_720x480_1mb.mp4")}else console.log("No video information available, using demo"),m.value=!0,a.value&&(a.value.video_url="https://sample-videos.com/zip/10/mp4/720/SampleVideo_720x480_1mb.mp4")}catch(t){C.value=t.message||"Erro ao carregar ocorr√™ncia"}finally{D.value=!1}},M=async()=>{try{x.value=await v.getOccurrenceUpdates(p)}catch(t){console.error("Error loading updates:",t)}},F=async()=>{try{L.value=await v.getAgents()}catch(t){console.error("Error loading agents:",t)}},z=async()=>{try{const t=await v.getServiceOrderByOccurrenceId(p);l.value=t,t&&(y.value=t.status)}catch(t){console.error("Error loading service order:",t)}},I=async()=>{try{await v.updateOccurrenceStatus(p,f.value),await A(),await M(),await z()}catch(t){console.error("Error updating status:",t)}},N=async()=>{try{await v.updateOccurrencePriority(p,V.value),await A()}catch(t){console.error("Error updating priority:",t)}},j=async()=>{try{await v.updateOccurrenceStatus(p,f.value,k.value),await A()}catch(t){console.error("Error updating assignment:",t)}},T=async()=>{if(_.value.trim()){w.value=!0;try{await v.addOccurrenceUpdate(p,_.value.trim()),_.value="",await M()}catch(t){console.error("Error adding comment:",t)}finally{w.value=!1}}},q=()=>{b.value&&(R.value=Math.round(b.value.duration).toString(),m.value=!1)},Z=()=>{m.value=!0,console.log("Video loading error - this is expected for demo purposes")},G=()=>{a.value&&(a.value.video_url="https://sample-videos.com/zip/10/mp4/720/SampleVideo_720x480_1mb.mp4",m.value=!1,b.value&&b.value.load())},c=t=>ie(new Date(t),"dd/MM/yyyy HH:mm",{locale:de}),Y=async()=>{if(l.value)try{const t=y.value==="completed"?new Date().toISOString():void 0;await v.updateServiceOrderStatus(l.value.id,y.value,t),await z()}catch(t){console.error("Error updating service order status:",t)}},J=async()=>{if(l.value){S.value=!0;try{const t=`
ORDEM DE SERVI√áO - ${l.value.protocol_number}

T√≠tulo: ${l.value.title}
Status: ${U(l.value.status)}
Prioridade: ${l.value.priority}/5
${l.value.due_date?`Data Limite: ${c(l.value.due_date)}`:""}

Descri√ß√£o:
${l.value.description}

${l.value.assigned_agent?`Respons√°vel: ${l.value.assigned_agent.full_name}`:""}

Criada em: ${c(l.value.created_at)}
${l.value.completed_at?`Conclu√≠da em: ${c(l.value.completed_at)}`:""}

Sistema CITY 4C - Gerado automaticamente
    `.trim(),s=new Blob([t],{type:"text/plain"}),n=window.URL.createObjectURL(s),g=document.createElement("a");g.href=n,g.download=`OS_${l.value.protocol_number}.txt`,g.click(),window.URL.revokeObjectURL(n)}catch(t){console.error("Error exporting service order:",t)}finally{S.value=!1}}},K=t=>new Date(t)<new Date,U=t=>({created:"Criada",in_progress:"Em Andamento",completed:"Conclu√≠da",cancelled:"Cancelada"})[t]||t,Q=t=>({pending:"Pendente",in_progress:"Em Andamento",resolved:"Resolvido",rejected:"Rejeitado"})[t]||t;return se(()=>{A(),M(),F(),z()}),(t,s)=>(d(),i("div",re,[D.value?(d(),i("div",ue,s[7]||(s[7]=[e("div",{class:"spinner"},null,-1),e("p",null,"Carregando detalhes da ocorr√™ncia...",-1)]))):C.value?(d(),i("div",ce,[s[8]||(s[8]=e("div",{class:"error-icon"},"‚ö†Ô∏è",-1)),s[9]||(s[9]=e("h3",null,"Erro ao carregar ocorr√™ncia",-1)),e("p",null,o(C.value),1),e("button",{onClick:s[0]||(s[0]=n=>t.$router.go(-1)),class:"btn btn-secondary"}," Voltar ")])):a.value?(d(),i("div",ve,[e("div",pe,[e("div",me,[e("button",{onClick:s[1]||(s[1]=n=>t.$router.go(-1)),class:"back-button"},s[10]||(s[10]=[e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})],-1),E(" Voltar ",-1)])),e("div",_e,[e("h1",null,o(a.value.title||"Ocorr√™ncia sem t√≠tulo"),1),e("div",ge,[a.value.tags?(d(),i("span",{key:0,class:"occurrence-tag",style:te({backgroundColor:a.value.tags.color+"20",color:a.value.tags.color})},o(a.value.tags.name),5)):u("",!0),e("span",fe,"ID: "+o(a.value.id.substring(0,8))+"...",1),e("span",ye,o(c(a.value.created_at)),1)])])]),e("div",be,[e("div",he,[s[12]||(s[12]=e("label",{for:"status-select",class:"control-label"},"Status:",-1)),h(e("select",{id:"status-select","onUpdate:modelValue":s[2]||(s[2]=n=>f.value=n),onChange:I,class:"form-select"},s[11]||(s[11]=[e("option",{value:"pending"},"Pendente",-1),e("option",{value:"in_progress"},"Em Andamento",-1),e("option",{value:"resolved"},"Resolvido",-1),e("option",{value:"rejected"},"Rejeitado",-1)]),544),[[O,f.value]])]),e("div",Ce,[s[14]||(s[14]=e("label",{for:"priority-select",class:"control-label"},"Prioridade:",-1)),h(e("select",{id:"priority-select","onUpdate:modelValue":s[3]||(s[3]=n=>V.value=n),onChange:N,class:"form-select"},s[13]||(s[13]=[ae('<option value="1" data-v-05ee2a40>M√≠nima</option><option value="2" data-v-05ee2a40>Baixa</option><option value="3" data-v-05ee2a40>M√©dia</option><option value="4" data-v-05ee2a40>Alta</option><option value="5" data-v-05ee2a40>Cr√≠tica</option>',5)]),544),[[O,V.value]])])])]),e("div",we,[e("div",Se,[e("div",Ve,[s[17]||(s[17]=e("h2",null,"V√≠deo da Ocorr√™ncia",-1)),e("div",ke,[e("video",{ref_key:"videoPlayer",ref:b,src:a.value.video_url,controls:"",preload:"metadata",class:"video-player",onLoadedmetadata:q,onError:Z}," Seu navegador n√£o suporta o elemento de v√≠deo. ",40,Ae),m.value?(d(),i("div",Ee,[s[15]||(s[15]=e("p",null,"‚ö†Ô∏è Arquivo de v√≠deo n√£o encontrado no storage.",-1)),s[16]||(s[16]=e("p",{class:"error-details"},"Este v√≠deo pode ter sido criptografado ou movido. Carregando v√≠deo de demonstra√ß√£o...",-1)),e("button",{onClick:G,class:"btn btn-primary"},"üé¨ Assistir V√≠deo Demo")])):u("",!0),e("div",Oe,[e("div",xe,[e("span",De," Dura√ß√£o: "+o(a.value.video_duration||R.value)+"s ",1),e("span",Me," Arquivo: "+o(a.value.video_filename),1)])])])]),a.value.description?(d(),i("div",ze,[s[18]||(s[18]=e("h2",null,"Descri√ß√£o",-1)),e("div",Le,[e("p",null,o(a.value.description),1)])])):u("",!0),e("div",Re,[s[21]||(s[21]=e("h2",null,"Atualiza√ß√µes",-1)),e("div",Ue,[e("form",{onSubmit:oe(T,["prevent"]),class:"comment-form"},[h(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=n=>_.value=n),placeholder:"Adicione uma atualiza√ß√£o ou coment√°rio...",class:"form-textarea",rows:"3",required:""},null,512),[[le,_.value]]),e("button",{type:"submit",class:"btn btn-primary",disabled:!_.value.trim()||w.value},o(w.value?"Adicionando...":"Adicionar Coment√°rio"),9,$e)],32)]),x.value.length>0?(d(),i("div",Be,[(d(!0),i(B,null,H(x.value,n=>(d(),i("div",{key:n.id,class:"update-item"},[e("div",He,[e("div",Pe,[e("div",Fe,o(n.profiles?.full_name?.[0]||"U"),1),e("div",Ie,[e("span",Ne,o(n.profiles?.full_name||"Usu√°rio"),1),e("span",je,o(c(n.created_at)),1)])]),n.status_change?(d(),i("div",Te,[s[19]||(s[19]=E(" Status alterado para: ",-1)),e("strong",null,o(Q(n.status_change)),1)])):u("",!0)]),e("div",qe,[e("p",null,o(n.comment),1)])]))),128))])):(d(),i("div",Ze,s[20]||(s[20]=[e("p",null,"Nenhuma atualiza√ß√£o ainda. Seja o primeiro a comentar!",-1)])))])]),e("div",Ge,[e("div",Ye,[s[27]||(s[27]=e("h3",null,"Localiza√ß√£o",-1)),e("div",Je,[e("div",Ke,[e("div",Qe,[s[22]||(s[22]=e("svg",{class:"map-icon",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})],-1)),s[23]||(s[23]=e("p",null,"Mapa Interativo",-1)),e("small",null,o(a.value.latitude.toFixed(6))+", "+o(a.value.longitude.toFixed(6)),1)])]),e("div",We,[e("div",Xe,[s[24]||(s[24]=e("span",{class:"label"},"Coordenadas:",-1)),e("span",es,o(a.value.latitude.toFixed(6))+", "+o(a.value.longitude.toFixed(6)),1)]),a.value.address?(d(),i("div",ss,[s[25]||(s[25]=e("span",{class:"label"},"Endere√ßo:",-1)),e("span",ts,o(a.value.address),1)])):u("",!0),a.value.location_accuracy?(d(),i("div",as,[s[26]||(s[26]=e("span",{class:"label"},"Precis√£o:",-1)),e("span",os,o(a.value.location_accuracy.toFixed(1))+"m",1)])):u("",!0)])])]),e("div",ls,[s[32]||(s[32]=e("h3",null,"Informa√ß√µes do Relator",-1)),e("div",ns,[e("div",is,[s[31]||(s[31]=e("div",{class:"reporter-avatar"},[e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})])],-1)),e("div",ds,[e("div",rs,[s[28]||(s[28]=e("span",{class:"label"},"Nome:",-1)),e("span",us,o(a.value.profiles?.full_name||"An√¥nimo"),1)]),e("div",cs,[s[29]||(s[29]=e("span",{class:"label"},"Tipo:",-1)),e("span",vs,o(a.value.reporter_type==="agent"?"Agente P√∫blico":"Cidad√£o"),1)]),a.value.profiles?.department?(d(),i("div",ps,[s[30]||(s[30]=e("span",{class:"label"},"Departamento:",-1)),e("span",ms,o(a.value.profiles.department),1)])):u("",!0)])])])]),e("div",_s,[s[34]||(s[34]=e("h3",null,"Respons√°vel",-1)),e("div",gs,[h(e("select",{"onUpdate:modelValue":s[5]||(s[5]=n=>k.value=n),onChange:j,class:"form-select"},[s[33]||(s[33]=e("option",{value:""},"N√£o atribu√≠do",-1)),(d(!0),i(B,null,H(L.value,n=>(d(),i("option",{key:n.id,value:n.id},o(n.full_name||n.id),9,fs))),128))],544),[[O,k.value]]),a.value.assigned_agent?(d(),i("div",ys,[e("div",bs,[e("div",hs,o(a.value.assigned_agent.full_name?.[0]||"A"),1),e("div",Cs,[e("span",ws,o(a.value.assigned_agent.full_name||"Agente"),1),e("span",Ss,o(a.value.assigned_agent.department||a.value.assigned_agent.role),1)])])])):u("",!0)])]),l.value?(d(),i("div",Vs,[s[44]||(s[44]=e("h3",null,[e("svg",{viewBox:"0 0 24 24",fill:"currentColor",class:"section-icon"},[e("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})]),E(" Ordem de Servi√ßo ")],-1)),e("div",ks,[e("div",As,[e("div",Es,[s[35]||(s[35]=e("span",{class:"label"},"Protocolo:",-1)),e("span",Os,o(l.value.protocol_number),1)]),e("div",{class:P(["os-status","os-status--"+l.value.status])},o(U(l.value.status)),3)]),e("div",xs,[e("div",Ds,[s[36]||(s[36]=e("span",{class:"label"},"T√≠tulo:",-1)),e("span",Ms,o(l.value.title),1)]),l.value.estimated_duration_hours?(d(),i("div",zs,[s[37]||(s[37]=e("span",{class:"label"},"Prazo Estimado:",-1)),e("span",Ls,o(l.value.estimated_duration_hours)+"h",1)])):u("",!0),l.value.due_date?(d(),i("div",Rs,[s[38]||(s[38]=e("span",{class:"label"},"Data Limite:",-1)),e("span",{class:P(["value due-date",{overdue:K(l.value.due_date)}])},o(c(l.value.due_date)),3)])):u("",!0),l.value.assigned_agent?(d(),i("div",Us,[s[39]||(s[39]=e("span",{class:"label"},"Respons√°vel:",-1)),e("span",$s,o(l.value.assigned_agent.full_name),1)])):u("",!0),e("div",Bs,[s[40]||(s[40]=e("span",{class:"label"},"Criada em:",-1)),e("span",Hs,o(c(l.value.created_at)),1)]),l.value.completed_at?(d(),i("div",Ps,[s[41]||(s[41]=e("span",{class:"label"},"Conclu√≠da em:",-1)),e("span",Fs,o(c(l.value.completed_at)),1)])):u("",!0)]),e("div",Is,[h(e("select",{"onUpdate:modelValue":s[6]||(s[6]=n=>y.value=n),onChange:Y,class:"form-select"},s[42]||(s[42]=[e("option",{value:"created"},"Criada",-1),e("option",{value:"in_progress"},"Em Andamento",-1),e("option",{value:"completed"},"Conclu√≠da",-1),e("option",{value:"cancelled"},"Cancelada",-1)]),544),[[O,y.value]]),e("button",{onClick:J,class:"btn btn-secondary btn-sm",disabled:S.value},[s[43]||(s[43]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1)),E(" "+o(S.value?"Exportando...":"Exportar OS"),1)],8,Ns)])])])):u("",!0),e("div",js,[s[49]||(s[49]=e("h3",null,"Metadados",-1)),e("div",Ts,[e("div",qs,[s[45]||(s[45]=e("span",{class:"label"},"Criado em:",-1)),e("span",Zs,o(c(a.value.created_at)),1)]),e("div",Gs,[s[46]||(s[46]=e("span",{class:"label"},"Atualizado em:",-1)),e("span",Ys,o(c(a.value.updated_at)),1)]),a.value.resolved_at?(d(),i("div",Js,[s[47]||(s[47]=e("span",{class:"label"},"Resolvido em:",-1)),e("span",Ks,o(c(a.value.resolved_at)),1)])):u("",!0),a.value.metadata?(d(),i("div",Qs,[s[48]||(s[48]=e("span",{class:"label"},"Dispositivo:",-1)),e("span",Ws,o(a.value.metadata.device_info?.platform||"N/A"),1)])):u("",!0)])])])])])):u("",!0)]))}}),ot=ne(Xs,[["__scopeId","data-v-05ee2a40"]]);export{ot as default};
