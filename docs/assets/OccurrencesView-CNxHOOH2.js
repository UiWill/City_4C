import{d as Z,a as u,r as K,q as O,D as P,y as Q,c as l,b as t,f as p,g as w,s as L,e as B,F as S,z as M,j as z,t as r,B as b,O as c,n as H,C as W,w as X,h as T,o as Y,p as i,_ as tt}from"./index-BZ6IL2aC.js";import{f as m,p as st}from"./pt-BR-BZBxiJ23.js";const et={class:"occurrences-view"},ot={class:"filters-section"},at={class:"filters-row"},lt={class:"filter-group"},it={class:"filter-group"},nt=["value"],rt={class:"filter-group"},dt={class:"filter-actions"},ut=["disabled"],pt={key:0,class:"animate-spin",viewBox:"0 0 24 24",fill:"currentColor"},ct={key:1,viewBox:"0 0 24 24",fill:"currentColor"},vt={class:"results-summary"},ft={key:0},gt={key:0,class:"loading-state"},yt={key:1,class:"empty-state"},bt={key:0},mt={key:1},_t={key:2,class:"occurrences-table-container"},Ct={class:"occurrences-table"},ht=["onClick"],kt={class:"occurrence-title-cell"},wt={class:"title-content"},Lt={key:0,class:"description-preview"},St={class:"priority-indicator"},Mt={class:"location-cell"},xt={class:"location-info"},Vt={key:0},Et={key:1},Rt={class:"actions-cell"},Dt=["onClick"],At=["onClick"],Ot=["onClick"],Pt={key:3,class:"pagination"},Bt=["disabled"],zt={class:"pagination-info"},Ht=["disabled"],x=20,Tt=Z({__name:"OccurrencesView",setup(Nt){const N=Y(),g=u([]),V=u([]),_=u(!1),v=u(!1),d=u(1),E=u(0),f=u(0),n=K({status:"",tag_id:"",priority:""}),C=O(()=>Math.ceil(f.value/x)),h=O(()=>n.status||n.tag_id||n.priority),y=async()=>{_.value=!0;try{const a={limit:x,offset:(d.value-1)*x};n.status&&(a.status=n.status),n.tag_id&&(a.tag_id=Number(n.tag_id));const s=await b.getOccurrences(a);let e=s;n.priority&&(e=s.filter(o=>o.priority===Number(n.priority))),g.value=e,f.value=e.length,h.value||(E.value=e.length)}catch(a){console.error("Error loading occurrences:",a)}finally{_.value=!1}},j=async()=>{try{V.value=await b.getTags()}catch(a){console.error("Error loading tags:",a)}},R=a=>{N.push(`/occurrences/${a}`)},D=async(a,s)=>{try{await b.updateOccurrenceStatus(a,s),await y()}catch(e){console.error("Error updating status:",e)}},F=()=>{n.status="",n.tag_id="",n.priority="",d.value=1},$=async()=>{v.value=!0;try{const a=await b.getOccurrences({}),s=I(a);U(s,`ocorrencias_${m(new Date,"yyyy-MM-dd_HH-mm")}.csv`)}catch(a){console.error("Error exporting CSV:",a)}finally{v.value=!1}},I=a=>{const s=["ID","Título","Descrição","Status","Prioridade","Categoria","Latitude","Longitude","Endereço","Tipo Relator","Relator","Data Criação","Data Resolução"],e=a.map(o=>[o.id,o.title||"",o.description||"",A(o.status),o.priority.toString(),o.tags?.name||"",o.latitude.toString(),o.longitude.toString(),o.address||"",o.reporter_type==="agent"?"Agente":"Cidadão",o.profiles?.full_name||"Anônimo",m(new Date(o.created_at),"dd/MM/yyyy HH:mm"),o.resolved_at?m(new Date(o.resolved_at),"dd/MM/yyyy HH:mm"):""]);return[s,...e].map(o=>o.map(k=>`"${k}"`).join(",")).join(`
`)},U=(a,s)=>{const e=new Blob([a],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),k=URL.createObjectURL(e);o.setAttribute("href",k),o.setAttribute("download",s),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)},A=a=>({[c.PENDING]:"Pendente",[c.IN_PROGRESS]:"Em Andamento",[c.RESOLVED]:"Resolvido",[c.REJECTED]:"Rejeitado"})[a]||a,q=()=>{d.value>1&&d.value--},G=()=>{d.value<C.value&&d.value++},J=a=>m(new Date(a),"dd/MM/yyyy HH:mm",{locale:st});return P(n,()=>{d.value=1,y()},{deep:!0}),P(d,()=>{y()}),Q(async()=>{await Promise.all([j(),y()])}),(a,s)=>(i(),l("div",et,[t("div",ot,[t("div",at,[t("div",lt,[s[5]||(s[5]=t("label",{for:"status-filter",class:"filter-label"},"Status",-1)),w(t("select",{id:"status-filter","onUpdate:modelValue":s[0]||(s[0]=e=>n.status=e),class:"form-select"},s[4]||(s[4]=[B('<option value="" data-v-3e5ff08b>Todos</option><option value="pending" data-v-3e5ff08b>Pendente</option><option value="in_progress" data-v-3e5ff08b>Em Andamento</option><option value="resolved" data-v-3e5ff08b>Resolvido</option><option value="rejected" data-v-3e5ff08b>Rejeitado</option>',5)]),512),[[L,n.status]])]),t("div",it,[s[7]||(s[7]=t("label",{for:"tag-filter",class:"filter-label"},"Categoria",-1)),w(t("select",{id:"tag-filter","onUpdate:modelValue":s[1]||(s[1]=e=>n.tag_id=e),class:"form-select"},[s[6]||(s[6]=t("option",{value:""},"Todas",-1)),(i(!0),l(S,null,M(V.value,e=>(i(),l("option",{key:e.id,value:e.id},r(e.name),9,nt))),128))],512),[[L,n.tag_id]])]),t("div",rt,[s[9]||(s[9]=t("label",{for:"priority-filter",class:"filter-label"},"Prioridade",-1)),w(t("select",{id:"priority-filter","onUpdate:modelValue":s[2]||(s[2]=e=>n.priority=e),class:"form-select"},s[8]||(s[8]=[B('<option value="" data-v-3e5ff08b>Todas</option><option value="5" data-v-3e5ff08b>Crítica</option><option value="4" data-v-3e5ff08b>Alta</option><option value="3" data-v-3e5ff08b>Média</option><option value="2" data-v-3e5ff08b>Baixa</option><option value="1" data-v-3e5ff08b>Mínima</option>',6)]),512),[[L,n.priority]])]),t("div",dt,[t("button",{onClick:F,class:"btn btn-secondary"}," Limpar Filtros "),t("button",{onClick:$,class:"btn btn-primary",disabled:v.value},[v.value?(i(),l("svg",pt,s[10]||(s[10]=[t("path",{d:"M12 4V2A10 10 0 0 0 2 12h2a8 8 0 0 1 8-8z"},null,-1)]))):(i(),l("svg",ct,s[11]||(s[11]=[t("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"},null,-1)]))),z(" "+r(v.value?"Exportando...":"Exportar CSV"),1)],8,ut)])])]),t("div",vt,[t("p",null,[t("strong",null,r(f.value),1),z(" ocorrência"+r(f.value!==1?"s":"")+" encontrada"+r(f.value!==1?"s":"")+" ",1),h.value?(i(),l("span",ft," (filtrado de "+r(E.value)+" total)",1)):p("",!0)])]),_.value?(i(),l("div",gt,s[12]||(s[12]=[t("div",{class:"spinner"},null,-1),t("p",null,"Carregando ocorrências...",-1)]))):g.value.length===0?(i(),l("div",yt,[s[13]||(s[13]=t("svg",{class:"empty-icon",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})],-1)),s[14]||(s[14]=t("h3",null,"Nenhuma ocorrência encontrada",-1)),h.value?(i(),l("p",bt," Tente ajustar os filtros para ver mais resultados. ")):(i(),l("p",mt," As ocorrências aparecerão aqui quando forem reportadas através do aplicativo. "))])):(i(),l("div",_t,[t("table",Ct,[s[20]||(s[20]=t("thead",null,[t("tr",null,[t("th",null,"Status"),t("th",null,"Título"),t("th",null,"Categoria"),t("th",null,"Prioridade"),t("th",null,"Localização"),t("th",null,"Data"),t("th",null,"Ações")])],-1)),t("tbody",null,[(i(!0),l(S,null,M(g.value,e=>(i(),l("tr",{key:e.id,class:"occurrence-row",onClick:o=>R(e.id)},[t("td",null,[t("span",{class:H(["status-badge",`status-badge--${e.status.replace("_","-")}`])},r(A(e.status)),3)]),t("td",kt,[t("div",wt,[t("h4",null,r(e.title||"Ocorrência sem título"),1),e.description?(i(),l("p",Lt,r(e.description.substring(0,80))+r(e.description.length>80?"...":""),1)):p("",!0)])]),t("td",null,[e.tags?(i(),l("span",{key:0,class:"category-tag",style:W({backgroundColor:e.tags.color+"20",color:e.tags.color})},r(e.tags.name),5)):p("",!0)]),t("td",null,[t("div",St,[(i(),l(S,null,M(5,o=>t("svg",{key:o,class:H(["priority-star",{"priority-star--active":o<=e.priority}]),viewBox:"0 0 24 24",fill:"currentColor"},s[15]||(s[15]=[t("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"},null,-1)]),2)),64))])]),t("td",Mt,[t("div",xt,[s[16]||(s[16]=t("svg",{class:"location-icon",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})],-1)),e.address?(i(),l("span",Vt,r(e.address.length>40?e.address.substring(0,40)+"...":e.address),1)):(i(),l("span",Et,r(e.latitude.toFixed(4))+", "+r(e.longitude.toFixed(4)),1))])]),t("td",null,r(J(e.created_at)),1),t("td",Rt,[t("div",{class:"quick-actions",onClick:s[3]||(s[3]=X(()=>{},["stop"]))},[e.status==="pending"?(i(),l("button",{key:0,class:"action-btn action-btn--success",onClick:o=>D(e.id,T(c).IN_PROGRESS),title:"Aceitar"},s[17]||(s[17]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"})],-1)]),8,Dt)):p("",!0),e.status==="in_progress"?(i(),l("button",{key:1,class:"action-btn action-btn--success",onClick:o=>D(e.id,T(c).RESOLVED),title:"Resolver"},s[18]||(s[18]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"})],-1)]),8,At)):p("",!0),t("button",{class:"action-btn action-btn--primary",onClick:o=>R(e.id),title:"Ver detalhes"},s[19]||(s[19]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})],-1)]),8,Ot)])])],8,ht))),128))])])])),g.value.length>0?(i(),l("div",Pt,[t("button",{disabled:d.value===1,onClick:q,class:"btn btn-secondary"}," Anterior ",8,Bt),t("span",zt," Página "+r(d.value)+" de "+r(C.value),1),t("button",{disabled:d.value===C.value,onClick:G,class:"btn btn-secondary"}," Próxima ",8,Ht)])):p("",!0)]))}}),$t=tt(Tt,[["__scopeId","data-v-3e5ff08b"]]);export{$t as default};
