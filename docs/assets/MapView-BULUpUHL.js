import{d as B,r as p,m as T,y as U,E as w,o as A,G as I,H as N,c as r,b as a,p as v,j as x,k as $,e as j,F as P,A as G,t as n,n as H,D as W,C as L,x as Z,l as d,_ as q}from"./index-BSN_zJ4g.js";import{L as c}from"./leaflet-DldNY6l7.js";import{f as J,p as K}from"./pt-BR-BZBxiJ23.js";const Q={class:"map-view"},X={class:"map-controls"},Y={class:"controls-left"},ee={class:"filter-group"},te={class:"filter-group"},ae=["value"],se={class:"controls-right"},oe={class:"occurrence-count"},le={class:"map-container"},ne={key:0,class:"occurrence-panel"},ie={class:"panel-header"},re={class:"panel-content"},de={class:"occurrence-info"},ce={class:"info-item"},ue={key:0,class:"info-item"},pe={class:"info-item"},ve={class:"coordinates"},me={key:1,class:"info-item"},ge={class:"info-item"},fe={key:2,class:"info-item description"},be={class:"panel-actions"},_e={key:1,class:"loading-overlay"},ke=B({__name:"MapView",setup(ye){delete c.Icon.Default.prototype._getIconUrl,c.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const D=Z(),g=p([]),k=p([]),s=p(null),f=p(!1),b=p(null);let i=null,u=null;const o=T({status:"",tag_id:""}),m=U(()=>{let t=g.value;return o.status&&(t=t.filter(e=>e.status===o.status)),o.tag_id&&(t=t.filter(e=>e.tag_id===Number(o.tag_id))),t}),M=async()=>{f.value=!0;try{g.value=await L.getOccurrences({limit:100})}catch(t){console.error("Error loading occurrences:",t)}finally{f.value=!1}},E=async()=>{try{k.value=await L.getTags()}catch(t){console.error("Error loading tags:",t)}},S=()=>{o.status="",o.tag_id=""},z=t=>{D.push(`/occurrences/${t}`)},F=async()=>{if(b.value)try{i=c.map(b.value,{zoomControl:!0,attributionControl:!1}).setView([-15.7942,-47.8822],4),c.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"",maxZoom:18}).addTo(i),u=c.layerGroup().addTo(i),_(),console.log("✅ Mapa inicializado com sucesso")}catch(t){console.error("❌ Erro ao inicializar mapa:",t)}},_=()=>{if(!(!i||!u)&&(u.clearLayers(),m.value.forEach(t=>{const e=V(t);e&&u.addLayer(e)}),m.value.length>0)){const t=new c.FeatureGroup(u.getLayers());t.getLayers().length>0&&i.fitBounds(t.getBounds(),{padding:[20,20]})}},V=t=>{if(!t.latitude||!t.longitude)return null;const e=O(t.status),l=c.divIcon({className:"custom-marker",html:`
      <div class="marker-pin" style="background-color: ${e};">
        <div class="marker-pulse"></div>
      </div>
    `,iconSize:[30,30],iconAnchor:[15,15]}),h=c.marker([t.latitude,t.longitude],{icon:l}),R=`
    <div class="occurrence-popup">
      <h4>${t.title||"Ocorrência sem título"}</h4>
      ${t.tags?`<p class="popup-tag"><strong>Categoria:</strong> ${t.tags.name}</p>`:""}
      <p class="popup-status"><strong>Status:</strong> ${C(t.status)}</p>
      ${t.address?`<p class="popup-address"><strong>Endereço:</strong> ${t.address}</p>`:""}
      <p class="popup-coords">
        <strong>Coordenadas:</strong> ${t.latitude.toFixed(6)}, ${t.longitude.toFixed(6)}
      </p>
      <p class="popup-date">
        <strong>Data:</strong> ${y(t.created_at)}
      </p>
      <div class="popup-actions">
        <button 
          onclick="window.location.href='#/occurrences/${t.id}'"
          class="popup-btn"
        >
          Ver Detalhes
        </button>
      </div>
    </div>
  `;return h.bindPopup(R,{maxWidth:300,className:"custom-popup"}),h},O=t=>({pending:"#f59e0b",in_progress:"#3b82f6",resolved:"#10b981",rejected:"#ef4444"})[t]||"#6b7280",y=t=>J(new Date(t),"dd/MM/yyyy HH:mm",{locale:K}),C=t=>({pending:"Pendente",in_progress:"Em Andamento",resolved:"Resolvido",rejected:"Rejeitado"})[t]||t;return w(o,()=>{s.value=null,_()},{deep:!0}),w(g,()=>{_()}),A(async()=>{await E(),await M(),await I(),await F()}),N(()=>{i&&(i.remove(),i=null),u=null}),(t,e)=>(d(),r("div",Q,[a("div",X,[a("div",Y,[a("div",ee,[e[5]||(e[5]=a("label",{for:"map-status-filter",class:"filter-label"},"Status",-1)),x(a("select",{id:"map-status-filter","onUpdate:modelValue":e[0]||(e[0]=l=>o.status=l),class:"form-select"},e[4]||(e[4]=[j('<option value="" data-v-e395443b>Todos</option><option value="pending" data-v-e395443b>Pendente</option><option value="in_progress" data-v-e395443b>Em Andamento</option><option value="resolved" data-v-e395443b>Resolvido</option><option value="rejected" data-v-e395443b>Rejeitado</option>',5)]),512),[[$,o.status]])]),a("div",te,[e[7]||(e[7]=a("label",{for:"map-tag-filter",class:"filter-label"},"Categoria",-1)),x(a("select",{id:"map-tag-filter","onUpdate:modelValue":e[1]||(e[1]=l=>o.tag_id=l),class:"form-select"},[e[6]||(e[6]=a("option",{value:""},"Todas",-1)),(d(!0),r(P,null,G(k.value,l=>(d(),r("option",{key:l.id,value:l.id},n(l.name),9,ae))),128))],512),[[$,o.tag_id]])]),a("button",{onClick:S,class:"btn btn-secondary"}," Limpar Filtros ")]),a("div",se,[a("div",oe,n(m.value.length)+" ocorrência"+n(m.value.length!==1?"s":"")+" no mapa ",1)])]),a("div",le,[a("div",{ref_key:"mapContainer",ref:b,class:"leaflet-map"},null,512),e[8]||(e[8]=j('<div class="map-legend" data-v-e395443b><h4 data-v-e395443b>Legenda</h4><div class="legend-items" data-v-e395443b><div class="legend-item" data-v-e395443b><div class="legend-marker marker--pending" data-v-e395443b></div><span data-v-e395443b>Pendente</span></div><div class="legend-item" data-v-e395443b><div class="legend-marker marker--in-progress" data-v-e395443b></div><span data-v-e395443b>Em Andamento</span></div><div class="legend-item" data-v-e395443b><div class="legend-marker marker--resolved" data-v-e395443b></div><span data-v-e395443b>Resolvido</span></div><div class="legend-item" data-v-e395443b><div class="legend-marker marker--rejected" data-v-e395443b></div><span data-v-e395443b>Rejeitado</span></div></div></div>',1))]),s.value?(d(),r("div",ne,[a("div",ie,[a("h3",null,n(s.value.title||"Ocorrência sem título"),1),a("button",{onClick:e[2]||(e[2]=l=>s.value=null),class:"close-button"},e[9]||(e[9]=[a("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[a("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)]))]),a("div",re,[a("div",de,[a("div",ce,[e[10]||(e[10]=a("span",{class:"label"},"Status:",-1)),a("span",{class:H(["status-badge",`status-badge--${s.value.status.replace("_","-")}`])},n(C(s.value.status)),3)]),s.value.tags?(d(),r("div",ue,[e[11]||(e[11]=a("span",{class:"label"},"Categoria:",-1)),a("span",{class:"tag-badge",style:W({backgroundColor:s.value.tags.color+"20",color:s.value.tags.color})},n(s.value.tags.name),5)])):v("",!0),a("div",pe,[e[12]||(e[12]=a("span",{class:"label"},"Localização:",-1)),a("span",ve,n(s.value.latitude.toFixed(6))+", "+n(s.value.longitude.toFixed(6)),1)]),s.value.address?(d(),r("div",me,[e[13]||(e[13]=a("span",{class:"label"},"Endereço:",-1)),a("span",null,n(s.value.address),1)])):v("",!0),a("div",ge,[e[14]||(e[14]=a("span",{class:"label"},"Data:",-1)),a("span",null,n(y(s.value.created_at)),1)]),s.value.description?(d(),r("div",fe,[e[15]||(e[15]=a("span",{class:"label"},"Descrição:",-1)),a("p",null,n(s.value.description),1)])):v("",!0)]),a("div",be,[a("button",{onClick:e[3]||(e[3]=l=>z(s.value.id)),class:"btn btn-primary"}," Ver Detalhes ")])])])):v("",!0),f.value?(d(),r("div",_e,e[16]||(e[16]=[a("div",{class:"spinner"},null,-1),a("p",null,"Carregando ocorrências...",-1)]))):v("",!0)]))}}),xe=q(ke,[["__scopeId","data-v-e395443b"]]);export{xe as default};
