import{d as k,m as b,r as w,y as S,c as i,b as o,e as x,i as M,p as n,j as u,v as p,n as f,t as m,s as z,k as E,h as _,f as U,w as q,g as B,z as h,x as L,l as d,_ as R}from"./index-DYjkjjR3.js";const T={class:"register-page"},D={class:"register-container"},F={class:"register-card"},j={class:"form-group"},A=["disabled"],I={key:0,class:"form-error"},O={class:"form-group"},$=["disabled"],H={key:0,class:"form-error"},J={class:"form-group"},Q={class:"password-input"},Y=["type","disabled"],G=["disabled"],K={viewBox:"0 0 24 24",fill:"currentColor"},W={key:0,d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"},X={key:1,d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"},Z={key:0,class:"form-error"},ee={class:"form-group"},se=["disabled"],oe={key:0,class:"form-error"},ae={class:"form-group"},re=["disabled"],le={key:0,class:"form-error"},te={class:"form-group"},ie=["disabled"],de={class:"form-group"},ne=["disabled"],me=["disabled"],ue={key:0,class:"loading-spinner"},pe={key:0,class:"general-error"},fe={key:1,class:"success-message"},ce={class:"register-footer"},ve=k({__name:"RegisterView",setup(ge){const y=L(),s=b({fullName:"",email:"",password:"",confirmPassword:"",role:"",department:"",phone:""}),a=b({fullName:"",email:"",password:"",confirmPassword:"",role:"",general:""}),c=w(!1),t=w(!1),v=w(""),C=S(()=>s.fullName&&s.email&&s.password&&s.confirmPassword&&s.role&&s.password===s.confirmPassword&&s.password.length>=6),N=()=>{a.fullName="",a.email="",a.password="",a.confirmPassword="",a.role="",a.general=""},P=()=>{N();let r=!0;return s.fullName.trim()||(a.fullName="Nome completo é obrigatório",r=!1),s.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)||(a.email="Email inválido",r=!1):(a.email="Email é obrigatório",r=!1),s.password?s.password.length<6&&(a.password="Senha deve ter pelo menos 6 caracteres",r=!1):(a.password="Senha é obrigatória",r=!1),s.confirmPassword?s.password!==s.confirmPassword&&(a.confirmPassword="Senhas não coincidem",r=!1):(a.confirmPassword="Confirmação de senha é obrigatória",r=!1),s.role||(a.role="Função é obrigatória",r=!1),r},V=async()=>{if(P()){t.value=!0,v.value="";try{const{data:r,error:e}=await h.auth.signUp({email:s.email,password:s.password,options:{data:{full_name:s.fullName.trim(),role:s.role}}});if(e)throw e;if(r.user){const{error:g}=await h.from("profiles").insert({id:r.user.id,full_name:s.fullName.trim(),role:s.role,department:s.department.trim()||null,phone:s.phone.trim()||null,is_active:!0});g&&console.error("Profile creation error:",g),v.value="Conta criada com sucesso! Verifique seu email para confirmar a conta.",Object.keys(s).forEach(l=>{s[l]=""}),setTimeout(()=>{y.push("/login")},3e3)}}catch(r){console.error("Registration error:",r),r.message?.includes("User already registered")?a.email="Este email já está cadastrado":r.message?.includes("Password should be at least 6 characters")?a.password="Senha deve ter pelo menos 6 caracteres":r.message?.includes("Invalid email")?a.email="Email inválido":a.general="Erro ao criar conta. Tente novamente."}finally{t.value=!1}}};return(r,e)=>{const g=B("RouterLink");return d(),i("div",T,[o("div",D,[o("div",F,[e[19]||(e[19]=x('<div class="register-header" data-v-a9f31707><div class="register-logo" data-v-a9f31707><svg class="register-logo__icon" viewBox="0 0 24 24" fill="currentColor" data-v-a9f31707><path d="M17 10.5V7a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h12a1 1 0 001-1v-3.5l4 2v-7l-4 2z" data-v-a9f31707></path></svg></div><h1 class="register-title" data-v-a9f31707>Criar Conta</h1><p class="register-subtitle" data-v-a9f31707>CITY 4C - Painel Administrativo</p></div>',1)),o("form",{onSubmit:M(V,["prevent"]),class:"register-form"},[o("div",j,[e[8]||(e[8]=o("label",{for:"full-name",class:"form-label"},"Nome Completo *",-1)),u(o("input",{id:"full-name","onUpdate:modelValue":e[0]||(e[0]=l=>s.fullName=l),type:"text",class:f(["form-input",{"form-input--error":a.fullName}]),placeholder:"Seu nome completo",required:"",disabled:t.value},null,10,A),[[p,s.fullName]]),a.fullName?(d(),i("div",I,m(a.fullName),1)):n("",!0)]),o("div",O,[e[9]||(e[9]=o("label",{for:"email",class:"form-label"},"Email *",-1)),u(o("input",{id:"email","onUpdate:modelValue":e[1]||(e[1]=l=>s.email=l),type:"email",class:f(["form-input",{"form-input--error":a.email}]),placeholder:"seu@email.com",required:"",disabled:t.value},null,10,$),[[p,s.email]]),a.email?(d(),i("div",H,m(a.email),1)):n("",!0)]),o("div",J,[e[10]||(e[10]=o("label",{for:"password",class:"form-label"},"Senha *",-1)),o("div",Q,[u(o("input",{id:"password","onUpdate:modelValue":e[2]||(e[2]=l=>s.password=l),type:c.value?"text":"password",class:f(["form-input",{"form-input--error":a.password}]),placeholder:"••••••••",required:"",disabled:t.value},null,10,Y),[[z,s.password]]),o("button",{type:"button",class:"password-toggle",onClick:e[3]||(e[3]=l=>c.value=!c.value),disabled:t.value},[(d(),i("svg",K,[c.value?(d(),i("path",W)):(d(),i("path",X))]))],8,G)]),a.password?(d(),i("div",Z,m(a.password),1)):n("",!0),e[11]||(e[11]=o("small",{class:"form-help"},"Mínimo 6 caracteres",-1))]),o("div",ee,[e[12]||(e[12]=o("label",{for:"confirm-password",class:"form-label"},"Confirmar Senha *",-1)),u(o("input",{id:"confirm-password","onUpdate:modelValue":e[4]||(e[4]=l=>s.confirmPassword=l),type:"password",class:f(["form-input",{"form-input--error":a.confirmPassword}]),placeholder:"••••••••",required:"",disabled:t.value},null,10,se),[[p,s.confirmPassword]]),a.confirmPassword?(d(),i("div",oe,m(a.confirmPassword),1)):n("",!0)]),o("div",ae,[e[14]||(e[14]=o("label",{for:"role",class:"form-label"},"Função *",-1)),u(o("select",{id:"role","onUpdate:modelValue":e[5]||(e[5]=l=>s.role=l),class:f(["form-select",{"form-input--error":a.role}]),required:"",disabled:t.value},e[13]||(e[13]=[o("option",{value:""},"Selecione sua função",-1),o("option",{value:"agent"},"Agente Público",-1),o("option",{value:"admin"},"Administrador",-1)]),10,re),[[E,s.role]]),a.role?(d(),i("div",le,m(a.role),1)):n("",!0)]),o("div",te,[e[15]||(e[15]=o("label",{for:"department",class:"form-label"},"Departamento",-1)),u(o("input",{id:"department","onUpdate:modelValue":e[6]||(e[6]=l=>s.department=l),type:"text",class:"form-input",placeholder:"Ex: Secretaria de Obras",disabled:t.value},null,8,ie),[[p,s.department]])]),o("div",de,[e[16]||(e[16]=o("label",{for:"phone",class:"form-label"},"Telefone",-1)),u(o("input",{id:"phone","onUpdate:modelValue":e[7]||(e[7]=l=>s.phone=l),type:"tel",class:"form-input",placeholder:"(11) 99999-9999",disabled:t.value},null,8,ne),[[p,s.phone]])]),o("button",{type:"submit",class:"submit-button",disabled:t.value||!C.value},[t.value?(d(),i("div",ue)):n("",!0),o("span",null,m(t.value?"Criando conta...":"Criar Conta"),1)],8,me),a.general?(d(),i("div",pe,m(a.general),1)):n("",!0),v.value?(d(),i("div",fe,m(v.value),1)):n("",!0)],32),o("div",ce,[o("p",null,[e[18]||(e[18]=_(" Já tem uma conta? ",-1)),U(g,{to:"/login",class:"login-link"},{default:q(()=>e[17]||(e[17]=[_("Faça login",-1)])),_:1,__:[17]})])]),e[20]||(e[20]=o("div",{class:"mvp-notice"},[o("div",{class:"mvp-notice__icon"},[o("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[o("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})])]),o("div",null,[o("h3",null,"Versão MVP"),o("p",null,"Qualquer pessoa pode criar uma conta de teste. Em produção, apenas administradores autorizados poderão criar novas contas.")])],-1))])])])}}}),be=R(ve,[["__scopeId","data-v-a9f31707"]]);export{be as default};
