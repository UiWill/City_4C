import{d as Q,E as W,a as d,y as X,c as i,f as c,b as e,t as a,j as E,C as ee,g as f,s as O,e as se,w as te,v as ae,F as U,z as B,n as H,B as v,p as r,_ as oe}from"./index-BBg9gfSf.js";import{f as le,p as ne}from"./pt-BR-BZBxiJ23.js";const ie={class:"occurrence-detail"},re={key:0,class:"loading-state"},de={key:1,class:"error-state"},ce={key:2,class:"occurrence-content"},ue={class:"occurrence-header"},ve={class:"header-main"},pe={class:"header-info"},me={class:"header-meta"},_e={class:"occurrence-id"},ge={class:"occurrence-date"},ye={class:"header-actions"},fe={class:"status-controls"},be={class:"priority-controls"},he={class:"main-content"},Ce={class:"left-column"},we={class:"video-section"},Se={class:"video-container"},ke=["src"],Ve={key:0,class:"video-error"},Ee={class:"video-info"},Oe={class:"video-meta"},Ae={class:"video-duration"},xe={class:"video-filename"},De={key:0,class:"description-section"},Me={class:"description-content"},Le={class:"updates-section"},Re={class:"add-comment"},$e=["disabled"],ze={key:0,class:"updates-list"},Ue={class:"update-header"},Be={class:"update-author"},He={class:"author-avatar"},Pe={class:"author-info"},Ie={class:"author-name"},je={class:"update-date"},Ne={key:0,class:"status-change"},Fe={class:"update-content"},Te={key:1,class:"no-updates"},qe={class:"right-column"},Ze={class:"location-section"},Ge={class:"location-content"},Ye={class:"map-placeholder"},Je={class:"map-content"},Ke={class:"location-details"},Qe={class:"detail-item"},We={class:"value coordinates"},Xe={key:0,class:"detail-item"},es={class:"value"},ss={key:1,class:"detail-item"},ts={class:"value"},as={class:"reporter-section"},os={class:"reporter-content"},ls={class:"reporter-info"},ns={class:"reporter-details"},is={class:"detail-item"},rs={class:"value"},ds={class:"detail-item"},cs={class:"value"},us={key:0,class:"detail-item"},vs={class:"value"},ps={class:"assignment-section"},ms={class:"assignment-content"},_s=["value"],gs={key:0,class:"assigned-info"},ys={class:"agent-info"},fs={class:"agent-avatar"},bs={class:"agent-details"},hs={class:"agent-name"},Cs={class:"agent-role"},ws={key:0,class:"service-order-section"},Ss={class:"service-order-content"},ks={class:"os-header"},Vs={class:"protocol-number"},Es={class:"value protocol"},Os={class:"os-details"},As={class:"detail-item"},xs={class:"value"},Ds={key:0,class:"detail-item"},Ms={class:"value"},Ls={key:1,class:"detail-item"},Rs={key:2,class:"detail-item"},$s={class:"value"},zs={class:"detail-item"},Us={class:"value"},Bs={key:3,class:"detail-item"},Hs={class:"value"},Ps={class:"os-actions"},Is=["disabled"],js={class:"metadata-section"},Ns={class:"metadata-content"},Fs={class:"detail-item"},Ts={class:"value"},qs={class:"detail-item"},Zs={class:"value"},Gs={key:0,class:"detail-item"},Ys={class:"value"},Js={key:1,class:"detail-item"},Ks={class:"value"},Qs=Q({__name:"OccurrenceDetailView",setup(Ws){const p=W().params.id,o=d(null),A=d([]),R=d([]),l=d(null),x=d(!1),b=d(""),h=d(!1),m=d(""),$=d(""),C=d(!1),_=d("pending"),w=d(1),S=d(""),g=d("created"),y=d(),k=d(!1),V=async()=>{x.value=!0,b.value="";try{const t=await v.getOccurrenceById(p);o.value=t,_.value=t.status,w.value=t.priority,S.value=t.assigned_to||""}catch(t){b.value=t.message||"Erro ao carregar ocorrência"}finally{x.value=!1}},D=async()=>{try{A.value=await v.getOccurrenceUpdates(p)}catch(t){console.error("Error loading updates:",t)}},P=async()=>{try{R.value=await v.getAgents()}catch(t){console.error("Error loading agents:",t)}},M=async()=>{try{const t=await v.getServiceOrderByOccurrenceId(p);l.value=t,t&&(g.value=t.status)}catch(t){console.error("Error loading service order:",t)}},I=async()=>{try{await v.updateOccurrenceStatus(p,_.value),await V(),await D(),await M()}catch(t){console.error("Error updating status:",t)}},j=async()=>{try{await v.updateOccurrencePriority(p,w.value),await V()}catch(t){console.error("Error updating priority:",t)}},N=async()=>{try{await v.updateOccurrenceStatus(p,_.value,S.value),await V()}catch(t){console.error("Error updating assignment:",t)}},F=async()=>{if(m.value.trim()){h.value=!0;try{await v.addOccurrenceUpdate(p,m.value.trim()),m.value="",await D()}catch(t){console.error("Error adding comment:",t)}finally{h.value=!1}}},T=()=>{y.value&&($.value=Math.round(y.value.duration).toString(),k.value=!1)},q=()=>{k.value=!0,console.log("Video loading error - this is expected for demo purposes")},Z=()=>{y.value&&o.value&&(y.value.src="https://sample-videos.com/zip/10/mp4/720/SampleVideo_720x480_1mb.mp4",k.value=!1)},u=t=>le(new Date(t),"dd/MM/yyyy HH:mm",{locale:ne}),G=async()=>{if(l.value)try{const t=g.value==="completed"?new Date().toISOString():void 0;await v.updateServiceOrderStatus(l.value.id,g.value,t),await M()}catch(t){console.error("Error updating service order status:",t)}},Y=async()=>{if(l.value){C.value=!0;try{const t=`
ORDEM DE SERVIÇO - ${l.value.protocol_number}

Título: ${l.value.title}
Status: ${z(l.value.status)}
Prioridade: ${l.value.priority}/5
${l.value.due_date?`Data Limite: ${u(l.value.due_date)}`:""}

Descrição:
${l.value.description}

${l.value.assigned_agent?`Responsável: ${l.value.assigned_agent.full_name}`:""}

Criada em: ${u(l.value.created_at)}
${l.value.completed_at?`Concluída em: ${u(l.value.completed_at)}`:""}

Sistema CITY 4C - Gerado automaticamente
    `.trim(),s=new Blob([t],{type:"text/plain"}),n=window.URL.createObjectURL(s),L=document.createElement("a");L.href=n,L.download=`OS_${l.value.protocol_number}.txt`,L.click(),window.URL.revokeObjectURL(n)}catch(t){console.error("Error exporting service order:",t)}finally{C.value=!1}}},J=t=>new Date(t)<new Date,z=t=>({created:"Criada",in_progress:"Em Andamento",completed:"Concluída",cancelled:"Cancelada"})[t]||t,K=t=>({pending:"Pendente",in_progress:"Em Andamento",resolved:"Resolvido",rejected:"Rejeitado"})[t]||t;return X(()=>{V(),D(),P(),M()}),(t,s)=>(r(),i("div",ie,[x.value?(r(),i("div",re,s[7]||(s[7]=[e("div",{class:"spinner"},null,-1),e("p",null,"Carregando detalhes da ocorrência...",-1)]))):b.value?(r(),i("div",de,[s[8]||(s[8]=e("div",{class:"error-icon"},"⚠️",-1)),s[9]||(s[9]=e("h3",null,"Erro ao carregar ocorrência",-1)),e("p",null,a(b.value),1),e("button",{onClick:s[0]||(s[0]=n=>t.$router.go(-1)),class:"btn btn-secondary"}," Voltar ")])):o.value?(r(),i("div",ce,[e("div",ue,[e("div",ve,[e("button",{onClick:s[1]||(s[1]=n=>t.$router.go(-1)),class:"back-button"},s[10]||(s[10]=[e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})],-1),E(" Voltar ",-1)])),e("div",pe,[e("h1",null,a(o.value.title||"Ocorrência sem título"),1),e("div",me,[o.value.tags?(r(),i("span",{key:0,class:"occurrence-tag",style:ee({backgroundColor:o.value.tags.color+"20",color:o.value.tags.color})},a(o.value.tags.name),5)):c("",!0),e("span",_e,"ID: "+a(o.value.id.substring(0,8))+"...",1),e("span",ge,a(u(o.value.created_at)),1)])])]),e("div",ye,[e("div",fe,[s[12]||(s[12]=e("label",{for:"status-select",class:"control-label"},"Status:",-1)),f(e("select",{id:"status-select","onUpdate:modelValue":s[2]||(s[2]=n=>_.value=n),onChange:I,class:"form-select"},s[11]||(s[11]=[e("option",{value:"pending"},"Pendente",-1),e("option",{value:"in_progress"},"Em Andamento",-1),e("option",{value:"resolved"},"Resolvido",-1),e("option",{value:"rejected"},"Rejeitado",-1)]),544),[[O,_.value]])]),e("div",be,[s[14]||(s[14]=e("label",{for:"priority-select",class:"control-label"},"Prioridade:",-1)),f(e("select",{id:"priority-select","onUpdate:modelValue":s[3]||(s[3]=n=>w.value=n),onChange:j,class:"form-select"},s[13]||(s[13]=[se('<option value="1" data-v-0a9134c6>Mínima</option><option value="2" data-v-0a9134c6>Baixa</option><option value="3" data-v-0a9134c6>Média</option><option value="4" data-v-0a9134c6>Alta</option><option value="5" data-v-0a9134c6>Crítica</option>',5)]),544),[[O,w.value]])])])]),e("div",he,[e("div",Ce,[e("div",we,[s[16]||(s[16]=e("h2",null,"Vídeo da Ocorrência",-1)),e("div",Se,[e("video",{ref_key:"videoPlayer",ref:y,src:o.value.video_url,controls:"",preload:"metadata",class:"video-player",onLoadedmetadata:T,onError:q}," Seu navegador não suporta o elemento de vídeo. ",40,ke),k.value?(r(),i("div",Ve,[s[15]||(s[15]=e("p",null,"⚠️ Erro ao carregar vídeo. Usando vídeo de demonstração.",-1)),e("button",{onClick:Z,class:"btn btn-primary"},"Carregar Vídeo Demo")])):c("",!0),e("div",Ee,[e("div",Oe,[e("span",Ae," Duração: "+a(o.value.video_duration||$.value)+"s ",1),e("span",xe," Arquivo: "+a(o.value.video_filename),1)])])])]),o.value.description?(r(),i("div",De,[s[17]||(s[17]=e("h2",null,"Descrição",-1)),e("div",Me,[e("p",null,a(o.value.description),1)])])):c("",!0),e("div",Le,[s[20]||(s[20]=e("h2",null,"Atualizações",-1)),e("div",Re,[e("form",{onSubmit:te(F,["prevent"]),class:"comment-form"},[f(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=n=>m.value=n),placeholder:"Adicione uma atualização ou comentário...",class:"form-textarea",rows:"3",required:""},null,512),[[ae,m.value]]),e("button",{type:"submit",class:"btn btn-primary",disabled:!m.value.trim()||h.value},a(h.value?"Adicionando...":"Adicionar Comentário"),9,$e)],32)]),A.value.length>0?(r(),i("div",ze,[(r(!0),i(U,null,B(A.value,n=>(r(),i("div",{key:n.id,class:"update-item"},[e("div",Ue,[e("div",Be,[e("div",He,a(n.profiles?.full_name?.[0]||"U"),1),e("div",Pe,[e("span",Ie,a(n.profiles?.full_name||"Usuário"),1),e("span",je,a(u(n.created_at)),1)])]),n.status_change?(r(),i("div",Ne,[s[18]||(s[18]=E(" Status alterado para: ",-1)),e("strong",null,a(K(n.status_change)),1)])):c("",!0)]),e("div",Fe,[e("p",null,a(n.comment),1)])]))),128))])):(r(),i("div",Te,s[19]||(s[19]=[e("p",null,"Nenhuma atualização ainda. Seja o primeiro a comentar!",-1)])))])]),e("div",qe,[e("div",Ze,[s[26]||(s[26]=e("h3",null,"Localização",-1)),e("div",Ge,[e("div",Ye,[e("div",Je,[s[21]||(s[21]=e("svg",{class:"map-icon",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})],-1)),s[22]||(s[22]=e("p",null,"Mapa Interativo",-1)),e("small",null,a(o.value.latitude.toFixed(6))+", "+a(o.value.longitude.toFixed(6)),1)])]),e("div",Ke,[e("div",Qe,[s[23]||(s[23]=e("span",{class:"label"},"Coordenadas:",-1)),e("span",We,a(o.value.latitude.toFixed(6))+", "+a(o.value.longitude.toFixed(6)),1)]),o.value.address?(r(),i("div",Xe,[s[24]||(s[24]=e("span",{class:"label"},"Endereço:",-1)),e("span",es,a(o.value.address),1)])):c("",!0),o.value.location_accuracy?(r(),i("div",ss,[s[25]||(s[25]=e("span",{class:"label"},"Precisão:",-1)),e("span",ts,a(o.value.location_accuracy.toFixed(1))+"m",1)])):c("",!0)])])]),e("div",as,[s[31]||(s[31]=e("h3",null,"Informações do Relator",-1)),e("div",os,[e("div",ls,[s[30]||(s[30]=e("div",{class:"reporter-avatar"},[e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})])],-1)),e("div",ns,[e("div",is,[s[27]||(s[27]=e("span",{class:"label"},"Nome:",-1)),e("span",rs,a(o.value.profiles?.full_name||"Anônimo"),1)]),e("div",ds,[s[28]||(s[28]=e("span",{class:"label"},"Tipo:",-1)),e("span",cs,a(o.value.reporter_type==="agent"?"Agente Público":"Cidadão"),1)]),o.value.profiles?.department?(r(),i("div",us,[s[29]||(s[29]=e("span",{class:"label"},"Departamento:",-1)),e("span",vs,a(o.value.profiles.department),1)])):c("",!0)])])])]),e("div",ps,[s[33]||(s[33]=e("h3",null,"Responsável",-1)),e("div",ms,[f(e("select",{"onUpdate:modelValue":s[5]||(s[5]=n=>S.value=n),onChange:N,class:"form-select"},[s[32]||(s[32]=e("option",{value:""},"Não atribuído",-1)),(r(!0),i(U,null,B(R.value,n=>(r(),i("option",{key:n.id,value:n.id},a(n.full_name||n.id),9,_s))),128))],544),[[O,S.value]]),o.value.assigned_agent?(r(),i("div",gs,[e("div",ys,[e("div",fs,a(o.value.assigned_agent.full_name?.[0]||"A"),1),e("div",bs,[e("span",hs,a(o.value.assigned_agent.full_name||"Agente"),1),e("span",Cs,a(o.value.assigned_agent.department||o.value.assigned_agent.role),1)])])])):c("",!0)])]),l.value?(r(),i("div",ws,[s[43]||(s[43]=e("h3",null,[e("svg",{viewBox:"0 0 24 24",fill:"currentColor",class:"section-icon"},[e("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})]),E(" Ordem de Serviço ")],-1)),e("div",Ss,[e("div",ks,[e("div",Vs,[s[34]||(s[34]=e("span",{class:"label"},"Protocolo:",-1)),e("span",Es,a(l.value.protocol_number),1)]),e("div",{class:H(["os-status","os-status--"+l.value.status])},a(z(l.value.status)),3)]),e("div",Os,[e("div",As,[s[35]||(s[35]=e("span",{class:"label"},"Título:",-1)),e("span",xs,a(l.value.title),1)]),l.value.estimated_duration_hours?(r(),i("div",Ds,[s[36]||(s[36]=e("span",{class:"label"},"Prazo Estimado:",-1)),e("span",Ms,a(l.value.estimated_duration_hours)+"h",1)])):c("",!0),l.value.due_date?(r(),i("div",Ls,[s[37]||(s[37]=e("span",{class:"label"},"Data Limite:",-1)),e("span",{class:H(["value due-date",{overdue:J(l.value.due_date)}])},a(u(l.value.due_date)),3)])):c("",!0),l.value.assigned_agent?(r(),i("div",Rs,[s[38]||(s[38]=e("span",{class:"label"},"Responsável:",-1)),e("span",$s,a(l.value.assigned_agent.full_name),1)])):c("",!0),e("div",zs,[s[39]||(s[39]=e("span",{class:"label"},"Criada em:",-1)),e("span",Us,a(u(l.value.created_at)),1)]),l.value.completed_at?(r(),i("div",Bs,[s[40]||(s[40]=e("span",{class:"label"},"Concluída em:",-1)),e("span",Hs,a(u(l.value.completed_at)),1)])):c("",!0)]),e("div",Ps,[f(e("select",{"onUpdate:modelValue":s[6]||(s[6]=n=>g.value=n),onChange:G,class:"form-select"},s[41]||(s[41]=[e("option",{value:"created"},"Criada",-1),e("option",{value:"in_progress"},"Em Andamento",-1),e("option",{value:"completed"},"Concluída",-1),e("option",{value:"cancelled"},"Cancelada",-1)]),544),[[O,g.value]]),e("button",{onClick:Y,class:"btn btn-secondary btn-sm",disabled:C.value},[s[42]||(s[42]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1)),E(" "+a(C.value?"Exportando...":"Exportar OS"),1)],8,Is)])])])):c("",!0),e("div",js,[s[48]||(s[48]=e("h3",null,"Metadados",-1)),e("div",Ns,[e("div",Fs,[s[44]||(s[44]=e("span",{class:"label"},"Criado em:",-1)),e("span",Ts,a(u(o.value.created_at)),1)]),e("div",qs,[s[45]||(s[45]=e("span",{class:"label"},"Atualizado em:",-1)),e("span",Zs,a(u(o.value.updated_at)),1)]),o.value.resolved_at?(r(),i("div",Gs,[s[46]||(s[46]=e("span",{class:"label"},"Resolvido em:",-1)),e("span",Ys,a(u(o.value.resolved_at)),1)])):c("",!0),o.value.metadata?(r(),i("div",Js,[s[47]||(s[47]=e("span",{class:"label"},"Dispositivo:",-1)),e("span",Ks,a(o.value.metadata.device_info?.platform||"N/A"),1)])):c("",!0)])])])])])):c("",!0)]))}}),tt=oe(Qs,[["__scopeId","data-v-0a9134c6"]]);export{tt as default};
