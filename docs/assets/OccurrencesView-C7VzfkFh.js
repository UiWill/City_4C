import{d as K,a as c,r as Q,q as B,D as W,y as X,c as i,b as t,f as u,g as w,s as x,e as D,F as M,z as S,j as O,t as l,B as _,C as Y,n as z,w as g,h as H,O as T,o as tt,p as n,_ as st}from"./index-BIMyVpsT.js";import{f,p as ot}from"./pt-BR-BZBxiJ23.js";const et={class:"occurrences-view"},at={class:"filters-section"},it={class:"filters-row"},nt={class:"filter-group"},lt={class:"filter-group"},rt=["value"],dt={class:"filter-group"},ct={class:"filter-actions"},ut=["disabled"],pt={key:0,class:"animate-spin",viewBox:"0 0 24 24",fill:"currentColor"},vt={key:1,viewBox:"0 0 24 24",fill:"currentColor"},_t={class:"results-summary"},yt={key:0},bt={key:0,class:"loading-state"},gt={key:1,class:"empty-state"},ft={key:0},mt={key:1},ht={key:2,class:"occurrences-list"},Ct=["onClick"],kt={class:"occurrence-header"},wt={class:"occurrence-info"},xt={class:"occurrence-title"},Mt={class:"occurrence-meta"},St={class:"occurrence-date"},Vt={class:"occurrence-status"},At={class:"priority-indicator"},Lt={class:"occurrence-content"},Et={class:"occurrence-details"},Pt={key:0,class:"occurrence-description"},Rt={class:"occurrence-location"},Bt={key:0},Dt={key:1,class:"coordinates"},Ot={key:1,class:"occurrence-reporter"},zt={class:"reporter-type"},Ht={key:2,class:"occurrence-reporter"},Tt={class:"video-thumbnail"},$t={class:"video-duration"},jt={class:"occurrence-actions"},Ft=["onClick"],Nt={class:"quick-actions"},Ut=["onClick"],qt=["onClick"],It=["onClick"],Gt={key:3,class:"pagination"},Zt=["disabled"],Jt={class:"pagination-info"},Kt=["disabled"],V=20,Qt=K({__name:"OccurrencesView",setup(Wt){const $=tt(),y=c([]),A=c([]),m=c(!1),p=c(!1),d=c(1),L=c(0),v=c(0),r=Q({status:"",tag_id:"",priority:""}),h=B(()=>Math.ceil(v.value/V)),C=B(()=>r.status||r.tag_id||r.priority),b=async()=>{m.value=!0;try{const a={limit:V,offset:(d.value-1)*V};r.status&&(a.status=r.status),r.tag_id&&(a.tag_id=Number(r.tag_id));const s=await _.getOccurrences(a);let o=s;r.priority&&(o=s.filter(e=>e.priority===Number(r.priority))),y.value=o,v.value=o.length,C.value||(L.value=o.length)}catch(a){console.error("Error loading occurrences:",a)}finally{m.value=!1}},j=async()=>{try{A.value=await _.getTags()}catch(a){console.error("Error loading tags:",a)}},E=a=>{$.push(`/occurrences/${a}`)},P=async(a,s)=>{try{await _.updateOccurrenceStatus(a,s),await b()}catch(o){console.error("Error updating status:",o)}},F=async a=>{const s=a.priority===5?1:a.priority+1;try{await _.updateOccurrencePriority(a.id,s),await b()}catch(o){console.error("Error updating priority:",o)}},N=()=>{r.status="",r.tag_id="",r.priority="",d.value=1},U=async()=>{p.value=!0;try{const a=await _.getOccurrences({}),s=q(a);I(s,`ocorrencias_${f(new Date,"yyyy-MM-dd_HH-mm")}.csv`)}catch(a){console.error("Error exporting CSV:",a)}finally{p.value=!1}},q=a=>{const s=["ID","Título","Descrição","Status","Prioridade","Categoria","Latitude","Longitude","Endereço","Tipo Relator","Relator","Data Criação","Data Resolução"],o=a.map(e=>[e.id,e.title||"",e.description||"",R(e.status),e.priority.toString(),e.tags?.name||"",e.latitude.toString(),e.longitude.toString(),e.address||"",e.reporter_type==="agent"?"Agente":"Cidadão",e.profiles?.full_name||"Anônimo",f(new Date(e.created_at),"dd/MM/yyyy HH:mm"),e.resolved_at?f(new Date(e.resolved_at),"dd/MM/yyyy HH:mm"):""]);return[s,...o].map(e=>e.map(k=>`"${k}"`).join(",")).join(`
`)},I=(a,s)=>{const o=new Blob([a],{type:"text/csv;charset=utf-8;"}),e=document.createElement("a"),k=URL.createObjectURL(o);e.setAttribute("href",k),e.setAttribute("download",s),e.style.visibility="hidden",document.body.appendChild(e),e.click(),document.body.removeChild(e)},G=()=>{d.value>1&&d.value--},Z=()=>{d.value<h.value&&d.value++},J=a=>f(new Date(a),"dd/MM/yyyy HH:mm",{locale:ot}),R=a=>({pending:"Pendente",in_progress:"Em Andamento",resolved:"Resolvido",rejected:"Rejeitado"})[a]||a;return W([r,d],()=>{b()},{deep:!0}),X(()=>{j(),b()}),(a,s)=>(n(),i("div",et,[t("div",at,[t("div",it,[t("div",nt,[s[4]||(s[4]=t("label",{for:"status-filter",class:"filter-label"},"Status",-1)),w(t("select",{id:"status-filter","onUpdate:modelValue":s[0]||(s[0]=o=>r.status=o),class:"form-select"},s[3]||(s[3]=[D('<option value="" data-v-bb2cba09>Todos</option><option value="pending" data-v-bb2cba09>Pendente</option><option value="in_progress" data-v-bb2cba09>Em Andamento</option><option value="resolved" data-v-bb2cba09>Resolvido</option><option value="rejected" data-v-bb2cba09>Rejeitado</option>',5)]),512),[[x,r.status]])]),t("div",lt,[s[6]||(s[6]=t("label",{for:"tag-filter",class:"filter-label"},"Categoria",-1)),w(t("select",{id:"tag-filter","onUpdate:modelValue":s[1]||(s[1]=o=>r.tag_id=o),class:"form-select"},[s[5]||(s[5]=t("option",{value:""},"Todas",-1)),(n(!0),i(M,null,S(A.value,o=>(n(),i("option",{key:o.id,value:o.id},l(o.name),9,rt))),128))],512),[[x,r.tag_id]])]),t("div",dt,[s[8]||(s[8]=t("label",{for:"priority-filter",class:"filter-label"},"Prioridade",-1)),w(t("select",{id:"priority-filter","onUpdate:modelValue":s[2]||(s[2]=o=>r.priority=o),class:"form-select"},s[7]||(s[7]=[D('<option value="" data-v-bb2cba09>Todas</option><option value="5" data-v-bb2cba09>Crítica</option><option value="4" data-v-bb2cba09>Alta</option><option value="3" data-v-bb2cba09>Média</option><option value="2" data-v-bb2cba09>Baixa</option><option value="1" data-v-bb2cba09>Mínima</option>',6)]),512),[[x,r.priority]])]),t("div",ct,[t("button",{onClick:N,class:"btn btn-secondary"}," Limpar Filtros "),t("button",{onClick:U,class:"btn btn-primary",disabled:p.value},[p.value?(n(),i("svg",pt,s[9]||(s[9]=[t("path",{d:"M12 4V2A10 10 0 0 0 2 12h2a8 8 0 0 1 8-8z"},null,-1)]))):(n(),i("svg",vt,s[10]||(s[10]=[t("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"},null,-1)]))),O(" "+l(p.value?"Exportando...":"Exportar CSV"),1)],8,ut)])])]),t("div",_t,[t("p",null,[t("strong",null,l(v.value),1),O(" ocorrência"+l(v.value!==1?"s":"")+" encontrada"+l(v.value!==1?"s":"")+" ",1),C.value?(n(),i("span",yt," (filtrado de "+l(L.value)+" total)",1)):u("",!0)])]),m.value?(n(),i("div",bt,s[11]||(s[11]=[t("div",{class:"spinner"},null,-1),t("p",null,"Carregando ocorrências...",-1)]))):y.value.length===0?(n(),i("div",gt,[s[12]||(s[12]=t("svg",{class:"empty-icon",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})],-1)),s[13]||(s[13]=t("h3",null,"Nenhuma ocorrência encontrada",-1)),C.value?(n(),i("p",ft," Tente ajustar os filtros para ver mais resultados. ")):(n(),i("p",mt," As ocorrências aparecerão aqui quando forem reportadas através do aplicativo. "))])):(n(),i("div",ht,[(n(!0),i(M,null,S(y.value,o=>(n(),i("div",{key:o.id,class:"occurrence-card",onClick:e=>E(o.id)},[t("div",kt,[t("div",wt,[t("h3",xt,l(o.title||"Ocorrência sem título"),1),t("div",Mt,[o.tags?(n(),i("span",{key:0,class:"occurrence-tag",style:Y({backgroundColor:o.tags.color+"20",color:o.tags.color})},l(o.tags.name),5)):u("",!0),t("span",St,l(J(o.created_at)),1)])]),t("div",Vt,[t("span",{class:z(["status-badge",`status-badge--${o.status.replace("_","-")}`])},l(R(o.status)),3),t("div",At,[(n(),i(M,null,S(5,e=>t("svg",{key:e,class:z(["priority-star",{"priority-star--active":e<=o.priority}]),viewBox:"0 0 24 24",fill:"currentColor"},s[14]||(s[14]=[t("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"},null,-1)]),2)),64))])])]),t("div",Lt,[t("div",Et,[o.description?(n(),i("p",Pt,l(o.description),1)):u("",!0),t("div",Rt,[s[15]||(s[15]=t("svg",{class:"location-icon",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})],-1)),o.address?(n(),i("span",Bt,l(o.address),1)):(n(),i("span",Dt,l(o.latitude.toFixed(6))+", "+l(o.longitude.toFixed(6)),1))]),o.profiles?(n(),i("div",Ot,[s[16]||(s[16]=t("svg",{class:"reporter-icon",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})],-1)),t("span",null,l(o.profiles.full_name||"Agente"),1),t("span",zt,"("+l(o.reporter_type==="agent"?"Agente":"Cidadão")+")",1)])):(n(),i("div",Ht,s[17]||(s[17]=[t("svg",{class:"reporter-icon",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})],-1),t("span",null,"Relato Anônimo",-1),t("span",{class:"reporter-type"},"(Cidadão)",-1)])))]),t("div",Tt,[s[18]||(s[18]=t("div",{class:"video-placeholder"},[t("svg",{class:"play-icon",viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M8 5v14l11-7z"})])],-1)),t("span",$t,l(o.video_duration?`${o.video_duration}s`:"~7s"),1)])]),t("div",jt,[t("button",{class:"action-btn action-btn--primary",onClick:g(e=>E(o.id),["stop"])}," Ver Detalhes ",8,Ft),t("div",Nt,[o.status==="pending"?(n(),i("button",{key:0,class:"action-btn action-btn--success",onClick:g(e=>P(o.id,H(T).IN_PROGRESS),["stop"])}," Aceitar ",8,Ut)):u("",!0),o.status==="in_progress"?(n(),i("button",{key:1,class:"action-btn action-btn--success",onClick:g(e=>P(o.id,H(T).RESOLVED),["stop"])}," Resolver ",8,qt)):u("",!0),t("button",{class:"action-btn action-btn--secondary",onClick:g(e=>F(o),["stop"])}," Prioridade "+l(o.priority),9,It)])])],8,Ct))),128))])),y.value.length>0?(n(),i("div",Gt,[t("button",{disabled:d.value===1,onClick:G,class:"btn btn-secondary"}," Anterior ",8,Zt),t("span",Jt," Página "+l(d.value)+" de "+l(h.value),1),t("button",{disabled:d.value===h.value,onClick:Z,class:"btn btn-secondary"}," Próxima ",8,Kt)])):u("",!0)]))}}),ts=st(Qt,[["__scopeId","data-v-bb2cba09"]]);export{ts as default};
